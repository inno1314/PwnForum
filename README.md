# PwnForum
## üåê OWASP Top-10 showcase –ø—Ä–æ–µ–∫—Ç

–î–∞–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—ã–ª–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞–∏–±–æ–ª–µ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ, –∞ —Ç–∞–∫–∂–µ —Å —Ü–µ–ª—å—é –ø–æ–∫–∞–∑–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–ø–æ—Å–æ–±—ã –∏—Ö —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è.
–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –Ω–∞ Python —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `Flask` –∏ `SQLite`.
–ö–∞–∂–¥—ã–π –ø—É–Ω–∫—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –¥–≤—É—Ö –≤–∞—Ä–∏–Ω—Ç–∞—Ö:
 - `vuln` ‚Äî —É—è–∑–≤–∏–º–∞—è –≤–µ—Ä—Å–∏—è
 - `fix` ‚Äî –≤–æ–∑–º–æ–∂–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

## üîß –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏
### 1. SQL-–∏–Ω—ä–µ–∫—Ü–∏—è
–î–∞–Ω–Ω—ã–π —Ç–∏–ø –∏–Ω—ä–µ–∫—Ü–∏–∏, –∫–∞–∫ –∏ –ø–æ—á—Ç–∏ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑—Ä—ã–≤ –º–µ–∂–¥—É –æ–∂–∏–¥–∞–Ω–∏—è–º–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ø—Ä–∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ —Ä–µ–∞–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º.
–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ –≤ –Ω–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ, —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –æ–∂–∏–¥–∞–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–µ–¥–µ—Ç –≤ –ø–æ–ª—è –ª–æ–≥–∏–Ω–∞ –∏ –ø–∞—Ä–æ–ª—è —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞. –ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–≤–æ–¥–∏—Ç—å –≤ –ø–æ–ª—è —á—Ç–æ —É–≥–æ–¥–Ω–æ.
–¢–∞–∫, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –¥–∞–Ω–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ –ë–î:
```python
query = f"SELECT * FROM users WHERE username = '{username}' AND password = '{password}'"
result = c.execute(query).fetchone()
```
–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–≤–µ—Å—Ç–∏ SQL –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ —Å–≤–æ–µ–≥–æ –ø–∞—Ä–æ–ª—è. –ù–∞–ø—Ä–∏–º–µ—Ä: `' OR '1'='1`. –¢–æ–≥–¥–∞ –∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:
```sql
SELECT * FROM users WHERE username = 'admin' AND password = '' OR '1'='1'
```
–¢.–∫. –¥–∞–Ω–Ω–æ–µ —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ –≤—Å–µ–≥–¥–∞ –≤–µ—Ä–Ω–æ, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–æ—Å—Ç—É–ø –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.

---

–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã ‚Äî –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–≤–æ–¥–æ–º —Ç–æ–ª—å–∫–æ —Ç–µ—Ö –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Å –∏–Ω—Ç—Ä–µ—Å—É—é—Ç (–ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å). –°–¥–µ–ª–∞—Ç—å —ç—Ç–æ –º–æ–∂–Ω–æ —Ç–∞–∫:
```python
query = "SELECT * FROM users WHERE username = ? AND password = ?"
result = c.execute(query, [username, password]).fetchone()
```
–î–∞–Ω–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç –ø–æ–ø—ã—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SQL –∑–∞–ø–æ—Ä—Å—ã —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
### 2. Plaintext Passwords
–•—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª–∏ –≤ —Ç–æ–º –∂–µ –≤–∏–¥–µ, –≤ –∫–æ—Ç–æ—Ä–æ–º –∏—Ö –≤–≤–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äî –ø–ª–æ—Ö–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞. –ü—Ä–∏ —É—Ç–µ—á–∫–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø–æ–ª—É—á–∏—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –∞–∫–∫–∞—É–Ω—Ç–∞–º –±–µ–∑ –¥–≤—É—Ö—ç—Ç–∞–ø–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –ë–æ–ª–µ–µ —Ç–æ–≥–æ, —Ç.–∫. –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞—á–∞—Å—Ç—É—é –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π (–∏–ª–∏ —Å—Ö–æ–∂–∏–π) –ø–∞—Ä–æ–ª—å –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Å–∞–π—Ç–∞—Ö, –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –¥—Ä—É–≥–∏–º –∞–∫–∫–∞—É–Ω—Ç–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã ‚Äî —Ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å:
```python
hashed_password = generate_password_hash(password)
if db.add_user(username, hashed_password):
    session["username"] = username
    return redirect("/forum")
else:
    stored_password = db.get_user_password(username)
    if check_password_hash(stored_password, password):
        session["username"] = username
        return redirect("/forum")
    else:
        error_message = "Invalid credentials"
```
–¢–æ–≥–¥–∞ –ø–æ—Å–ª–µ —É—Ç–µ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ —É–≤–∏–¥–∏—Ç —Ç–∞–∫–æ–π –ø–∞—Ä–æ–ª—å:
```sql
sqlite> SELECT password from users WHERE username='inno';
scrypt:32768:8:1$1nQYxR55zJbsPMz3$c1a5ac37dbefe3acac8965c331beb99c6bc68531caab0ef53bf69f2b1b00c04c1b487c4845242233a9a6e412c39094519950783d123ade51f22164b67d7c4778
```
### 3. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Äî –≤–∞–∂–Ω—ã–π –∞—Å–ø–µ–∫—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏; –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –º—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–æ—Å—Ç—É–ø –∫ –∫–∞–∫–æ–º—É-—Ç–æ —Ä–µ—Å—É—Ä—Å—É –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—É, –º—ã –¥–æ–ª–∂–Ω—ã —É–±–µ–¥–∏—Ç—Å—è, —á—Ç–æ —ç—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äî –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ç–æ—Ç, –∑–∞ –∫–æ–≥–æ –æ–Ω —Å–µ–±—è –≤—ã–¥–∞–µ—Ç.
–ï—Å—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ. –ù–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, —Å–æ–∑–¥–∞—Ç—å —Å–ø–µ—Ü–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ cookie:
```python
if result and username and password:
      resp = make_response(redirect("/forum"))
      resp.set_cookie("username", username)
      return resp
```
–î–∞–ª–µ–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ:
```python
username = request.cookies.get("username")
```
–í–∞—Ä–∏–∞–Ω—Ç –Ω–µ —Å–∞–º—ã–π —É–¥–∞—á–Ω—ã–π, —Ç.–∫. –Ω–µ–º–Ω–æ–≥–æ –ø–æ–Ω–∏–º–∞—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Å–æ —Å–≤–æ–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏–ª–∏ cookies:
```html
curl -b "username=admin" http://127.0.0.1:5000/forum

    <!DOCTYPE html>
    <html>
    <head><title>Forum (Vulnerable)</title></head>
    <body>
    <h2>Welcome, admin</h2>
```
–ù–∏–∫–∞–∫–æ–≥–æ –ø–∞—Ä–æ–ª—è, –ø—Ä–æ—Å—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ cookies. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å, –∞—Ç–∞–∫—É—é—â–∏–π —É—Å–ø–µ—à–Ω–æ –≤—ã–¥–∞–ª —Å–µ–±—è –∑–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.
–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–µ–¥—É—é—â–∏–º:
```python
if check_password_hash(stored_password, password):
    session["username"] = username
    return redirect("/forum")
```
–î–∞–ª–µ–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ:
```python
username = session.get("username")
if not username or not db.is_user_exists(username):
    return redirect("/")
```
–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ Flask –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–∞–º —Ä–µ—à–µ–Ω–∏–µ ‚Äî —Å–µ—Å—Å–∏–∏. –•—Ä–∞–Ω—è—Ç—Å—è –≤ cookie, –ø–æ–¥–ø–∏—Å–∞–Ω—ã —Å–µ–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—é—á–æ–º.
–í cookies —ç—Ç–æ –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫: `session=eyJ1c2VybmFtZSI6ImFkbWluIn0.aG_d6Q.7WvVYUy6-1f4gytlTz3DRD9uWmc`.
–ë–µ–∑ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é, –ø—Ä–∏ —ç—Ç–æ–º –ø–æ–ª—É—á–∏—Ç—å –Ω—É–∂–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –∑–Ω–∞—è —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á.
### 4. Cross-Site Scripting (XSS)
–ï—â–µ –æ–¥–∏–Ω –ø—Ä–∏–º–µ—Ä –Ω–µ–ø–æ–Ω–∏–º–∞–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º —Ç–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, —Å –∫–æ—Ç–æ—Ä—ã–º –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç. –í –Ω–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ñ–æ—Ä—É–º–∞ –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —á—Ç–æ-—Ç–æ –∑–∞–ø–æ—Å—Ç–∏—Ç—å.
–£—è–∑–≤–∏–º–æ—Å—Ç—å XSS –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –∫–æ–≥–¥–∞ —Ä–∞–∑—Ä–∞–±—Ç—á–∏–∫ —É–ø—É—Å–∫–∞–µ—Ç –∏–∑ –≤–∏–¥—É, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å —á—Ç–æ —É–≥–æ–¥–Ω–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–¥ JavaScript.
–ü—Ä–∏–º–µ—Ä –ø–ª–æ—Ö–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
```python
for post_user, content, timestamp, file_path in posts:
    html += f"""
    <div style='margin-bottom: 1em;'>
        <b>{post_user}</b> at {timestamp}<br>
        {content}<br>
        {f'<img src="{os.path.join(UPLOAD_FOLDER, file_path)}" style="max-width: 300px;">' if file_path else ""}
    </div>
    """
html += "</body></html>"
```
–î–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (—Ä—É—á–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è HTML) –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–≤–µ—Å—Ç–∏ –≤ –ø–æ–ª–µ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–≤–æ–π –∫–æ–¥:
```js
<script>alert(1)</script>
```
–ò —ç—Ç–æ—Ç –∫–æ–¥ –±—É–¥–µ—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
–û–¥–∏–Ω –∏–∑ —Å–ø–æ—Å–æ–±–æ–≤ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —ç—Ç–æ ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤:
```html
{% for post in posts %}
<div style='margin-bottom: 1em;'>
    <b>{{ post[0] | e }}</b> at {{ post[2] | e }}<br>
    {{ post[1] | e }}<br>
    {% if post[3] %}
        <img src="{{ url_for('static', filename='uploads/' + post[3]) }}" 
              style="max-width: 300px; margin-top: 10px;">
    {% endif %}
</div>
{% endfor %}
```
–î–∞–ª–µ–µ –≤ –∫–æ–¥–µ:
```python
return render_template(
    "forum.html",
    posts=posts,
    username=username,
    static_files_path=url_for("static", filename=""),
)
```
–¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞, –∞ –≤–µ—Å—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥ –±—É–¥–µ—Ç –≤–æ—Å–ø—Ä–∏–Ω—è—Ç –∫–∞–∫ –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç.
### 5. Local File Inclusion (LFI)
–ö–æ–≥–¥–∞ —Å–µ—Ä–≤–µ—Ä –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∫–∞–∫–∏–µ-—Ç–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ñ–∞–π–ª—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —É—è–∑–≤–∏–º–æ—Å—Ç—å—é path traversal –∏ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–∞–º –≤–Ω–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
–í –Ω–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–∞–π–ª—ã —Å–æ —Å–ø–∏—Å–∫–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
```python
file_path = request.args.get("file", "")
try:
    with open(f"app/changelogs/{file_path}", "r") as f:
        content = f.read()
except Exception as e:
        content = f"Error reading file: {str(e)}"
```
–ù–æ –Ω–∏—á—Ç–æ –Ω–µ –º–µ—à–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–≤–µ—Å—Ç–∏ —Ç–∞–∫–æ–π –ø—É—Ç—å:
`../../../../etc/passwd` –∏ –ø–æ–ª—É—á–∏—Ç—å –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∫–∞–∫–æ–π-—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.
–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```python
from werkzeug.utils import secure_filename

user_arg = request.args.get("file", "")
file_path = secure_filename(user_arg)
try:
    with open(f"app/changelogs/{file_path}", "r") as f:
        content = f.read()
except Exception:
    content = "Incorrect input"
```
–ó–¥–µ—Å—å –º—ã –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ —Å–ø–µ—Ü. —Å–∏–º–≤–æ–ª—ã, –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: —Å–æ–∑–¥–∞–Ω–∏–µ "–±–µ–ª–æ–≥–æ —Å–ø–∏—Å–∫–∞" —Ñ–∞–π–ª–æ–≤, –∫ –∫–æ—Ç–æ—Ä—ã–º –º–æ–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è.
### 6. IDOR
Insecure Direct Object Reference ‚Äî –≤–∏–¥ —É—è–∑–≤–∏–º–æ—Å—Ç–∏, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –¥–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å—É –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –ø—É—Ç–µ–º –º–∞–Ω–∏–ø—É–ª–∏—Ä–æ–≤–∞–Ω–∏—è URL —Å—Ç—Ä–æ–∫–æ–π. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ —ç—Ç–æ–º –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞—Ç—å –∑–∞–º–µ—Ç–∫—É –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π:
```python
@drafts_bp.route("/drafts/<username>", methods=["GET", "POST"])
def drafts(username):
     # ---
    drafts_for_user = db.get_user_drafts(username)
    drafts_for_user.reverse()
     # ---
    for draft in drafts_for_user:
        html += f"""
        <div style='margin-bottom: 1em;'>
        Draft ID: {draft[0]}<br>
        {draft[2]}<br>
        {f'<a href="{draft[3]}">File</a>' if draft[3] else ""}
        </div>
        """
```
–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –ª—é–±–æ–π –º–æ–∂–µ—Ç –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å —á—É–∂–æ–π —é–∑–µ—Ä–Ω–µ–π–º –∏ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —á—É–∂–∏–º –∑–∞–º–µ—Ç–∫–∞–º. –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–º–µ—Ç–æ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –≤ URL `drafts/inno` –Ω–∞ `drafts/admin`.
–†–µ—à–µ–Ω–∏–π –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ:
- –Ω–∞–¥–µ–∂–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:
```python
session_user = session.get("username")
if username != sesion_user:
    abort (403, "Forbidden")
```
- —Å–∫—Ä—ã—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ —Å—Å—ã–ª–∫–µ:
```python
@drafts_bp.route("/drafts", methods=["GET", "POST"])
def drafts():
    username = session["username"]
    if not username or not db.is_user_exists(username):
        return redirect("/")
```
### 7. Unrestricted File Upload
–î–∞–Ω–Ω–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –∫–æ–≥–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ —Å–º–æ–≥ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∑–∞–≥—Ä—É–∂–∞–µ–º—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Ñ–∞–π–ª—ã. –ò–Ω–æ–≥–¥–∞ –Ω–∞ –ø–µ—Ä–≤—ã–π –≤–∑–≥–ª—è–¥ –∫–∞–∂–µ—Ç—Å—è, —á—Ç–æ –≤ –∫–æ–¥–µ –µ—Å—Ç—å –≥—Ä–∞–º–æ—Ç–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞:
```python
def is_allowed(filename):
    allowed_extensions = {"png", "jpg", "jpeg"}
    return "." in filename and filename.rsplit(".", 1)[1].lower() in allowed_extensions
# ---
if file and file.filename and is_allowed(file.filename):
    file_path = os.path.join("app", UPLOAD_FOLDER, file.filename)
    file.save(file_path)
```
–ö–∞–∑–∞–ª–æ—Å—å –±—ã, –∑–¥–µ—Å—å –º—ã –≥—Ä–∞–º–æ—Ç–Ω–æ —Ä–∞–∑–±–∏–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –ø–æ —Å–∏–º–≤–æ–ª—É `.`, –∏—Å–ø–æ–ª—å–∑—É–µ–º `rsplit()` –∏ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑,
—Ç–æ –µ—Å—Ç—å —Ñ–∞–π–ª—ã –≤—Ä–æ–¥–µ malware.png.py –∏ —Ç.–ø. –Ω–µ –ø—Ä–æ–∫–∞—Ç—è—Ç. –ù–∞ —Å–∞–º–æ–º –∂–µ –¥–µ–ª–µ, –Ω–∏—á—Ç–æ –Ω–µ –º–µ—à–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–∞–∫–æ–π –∑–∞–ø—Ä–æ—Å:
```bash
curl -X POST \
  -F "draft_content=Malicious draft" \
  -F "file=@malicious.py;filename=image.png" \
  -F "action=save" \
  http://127.0.0.1:5000/drafts/inno
```
–ò–ª–∏ –∂–µ –ø—Ä–æ—Å—Ç–æ –∑–∞–ø–∏—Å–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤—Ä–µ–¥–æ–Ω–æ—Å–∞ –≤ `.png`. –ë–æ–ª–µ–µ —Ç–æ–≥–æ, –≤ —ç—Ç–æ–π —É—è–∑–≤–∏–º–æ–π –≤–µ—Ä—Å–∏–∏ –º—ã –º–æ–∂–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å
—Ñ–∞–π–ª—ã –≤–Ω–µ –∑–∞–¥–∞–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å –ø–æ–º–æ—â—å—é –ø—Ä–µ—Ñ–∏–∫—Å–∞ `../`:
```bash
curl -X POST \
  -F "draft_content=Malicious draft" \
  -F "file=@malicious.py;filename=../image.png" \
  -F "action=save" \
  http://127.0.0.1:5000/drafts/inno
```
–° —Ç–∞–∫–∏–º –ø–æ–¥—Ö–æ–¥–æ–º –º–æ–∂–Ω–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å —Ñ–∞–π–ª—ã —Å–∞–º–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---

–§–∏–∫—Å ‚Äî —Ç—â–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤ –ø–µ—Ä–µ–¥ –∏—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º:
```python
def is_safe_file(file):
    filename = secure_filename(file.filename) # Path traversal fix
    if not filename:
        return False

    ext = os.path.splitext(filename)[1].lower()
    if ext not in ALLOWED_EXTENSIONS:
        return False

    try:
        img = Image.open(file)
        img.verify()  # Verifies that it is, indeed, an image
    except Exception:
        return False
    file.seek(0)

    return True
```
–ï—â–µ –æ–¥–Ω–∞ –Ω–µ–±–æ–ª—å—à–∞—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞: —Å–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–º—ë–Ω –¥–ª—è —Ñ–∞–π–ª–æ–≤:
```python
def generate_filename(filename) -> str:
    safe_name = secure_filename(filename)
    prefix = uuid.uuid4().hex[:10]
    if not safe_name:
        return prefix
    return f"{prefix}_{safe_name}"
```

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫
–î–ª—è –∑–∞–ø—É—Å–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥–µ:
```bash
git clone https://github.com/inno1314/PwnForum.git

python3 -m venv .venv
source .venv/bin/activate

pip3 install -r requirements.txt
echo "APP_MODE=vuln" >> .env
flask run
```
–ó–∞–º–µ–Ω–∏—Ç—å `APP_MODE=fix` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ —Å–∞–π—Ç–∞.
